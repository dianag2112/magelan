<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Order Details â€” Magelan</title>

    <link href="https://fonts.googleapis.com/css2?family=Pirata+One&display=swap" rel="stylesheet">

    <link rel="stylesheet" th:href="@{/styles.css}" href="/styles.css">
    <link rel="stylesheet" th:href="@{/admin-panel.css}" href="/admin-panel.css">
</head>
<body class="admin-body">
<div class="admin-container">
    <div class="logo-container">
        <a th:href="@{/home}">
            <img src="/magelan_index.jpg" alt="Magelan Logo" class="logo-image">
        </a>
    </div>

    <section class="panel">
        <h1 class="title">Order Details</h1>

        <div th:if="${message != null and !#strings.isEmpty(message)}" class="alert success">
            <p th:text="${message}">Message</p>
        </div>
        <div th:if="${error != null and !#strings.isEmpty(error)}" class="alert error">
            <p th:text="${error}">Error</p>
        </div>

        <div class="order-summary">
            <p><strong>ID:</strong> <span th:text="${order.id}">id</span></p>
            <p><strong>Created:</strong>
                <span th:text="${#temporals.format(order.createdOn, 'dd.MM.yyyy HH:mm')}">
                    01.01.2025 19:30
                </span>
            </p>
            <p><strong>Status:</strong> <span th:text="${order.orderStatus}">SUBMITTED</span></p>
            <p><strong>Total:</strong>
                <span th:text="${#numbers.formatDecimal(order.amount, 1, 2)}">0.00</span>
            </p>
        </div>

        <h2 class="subtitle" style="margin-top: 20px;">Customer</h2>
        <div class="order-info-grid">
            <div>
                <p><strong>Username:</strong>
                    <span th:text="${order.customer != null ? order.customer.username : 'Unknown'}">
                        username
                    </span>
                </p>
                <p><strong>Profile Name:</strong>
                    <span th:text="${(order.customer != null ? (order.customer.firstName ?: '') : '') + ' ' +
                                    (order.customer != null ? (order.customer.lastName ?: '') : '')}">
                        First Last
                    </span>
                </p>
                <p><strong>Email:</strong>
                    <span th:text="${order.customer != null ? (order.customer.email ?: '-') : '-'}">-</span>
                </p>
            </div>
        </div>

        <h2 class="subtitle" style="margin-top: 20px;">Delivery Details</h2>
        <div class="order-info-grid">
            <div>
                <p><strong>Name:</strong>
                    <span th:text="${order.deliveryFullName ?: '-'}">-</span>
                </p>
                <p><strong>Phone:</strong>
                    <span th:text="${order.deliveryPhone ?: '-'}">-</span>
                </p>
                <p><strong>Address:</strong>
                    <span th:text="${order.deliveryAddress ?: '-'}">-</span>
                </p>
                <p><strong>Notes:</strong>
                    <span th:text="${order.deliveryNotes ?: '-'}">-</span>
                </p>
            </div>
        </div>

        <h2 class="subtitle" style="margin-top: 20px;">Items</h2>

        <div class="table-wrapper">
            <table class="users-table">
                <thead>
                <tr>
                    <th>Item</th>
                    <th class="col-center">Qty</th>
                    <th class="col-right">Unit Price</th>
                    <th class="col-right">Subtotal</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="item : ${order.items}">
                    <td th:text="${item.product != null ? item.product.name : 'Item'}">Magelan Burger</td>
                    <td class="col-center" th:text="${item.quantity}">1</td>
                    <td class="col-right"
                        th:text="${#numbers.formatDecimal(item.unitPrice, 1, 2)}">14.90</td>
                    <td class="col-right"
                        th:text="${#numbers.formatDecimal(item.totalPrice, 1, 2)}">14.90</td>
                </tr>
                </tbody>
            </table>
        </div>

        <div class="admin-actions" style="justify-content: space-between; margin-top: 20px;">
            <a th:href="@{/admin/orders}" class="btn-secondary">Back to Orders</a>

            <div class="action-buttons"
                 th:if="${order.orderStatus.name() == 'SUBMITTED' or order.orderStatus.name() == 'CONFIRMED'}">

                <form th:if="${order.orderStatus.name() == 'SUBMITTED'}"
                      th:action="@{|/admin/orders/${order.id}|}" method="post" class="inline-form">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                    <input type="hidden" name="_method" value="patch"/>
                    <input type="hidden" name="status" value="CONFIRMED"/>
                    <button type="submit" class="btn-toggle">Confirm</button>
                </form>

                <form th:if="${order.orderStatus.name() == 'CONFIRMED'}"
                      th:action="@{|/admin/orders/${order.id}|}" method="post" class="inline-form">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                    <input type="hidden" name="_method" value="patch"/>
                    <input type="hidden" name="status" value="DELIVERED"/>
                    <button type="submit" class="btn-toggle demote">Mark Delivered</button>
                </form>
            </div>
        </div>
    </section>
</div>
</body>
</html>
