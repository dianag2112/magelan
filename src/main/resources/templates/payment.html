<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payment â€” Magelan</title>

    <link href="https://fonts.googleapis.com/css2?family=Pirata+One&display=swap" rel="stylesheet">

    <link rel="stylesheet" th:href="@{/styles.css}" href="/styles.css">
    <link rel="stylesheet" th:href="@{/payment.css}" href="/payment.css">
</head>
<body class="payment-body">
<div class="payment-container">
    <div class="logo-container">
        <a th:href="${isAuthenticated} ? @{/home} : @{/}" href="/">
            <img src="/magelan-index.jpg" alt="Magelan Logo" class="logo-image">
        </a>
    </div>

    <section class="panel payment-panel">
        <h1 class="title">Payment</h1>

        <div th:if="${payment == null}" class="empty">
            <p>Payment information could not be found.</p>
            <div class="payment-actions">
                <a th:href="@{/orders}" href="/orders" class="btn-secondary">Back to my orders</a>
            </div>
        </div>

        <div th:if="${payment != null}">
            <div class="payment-summary">
                <p>
                    <span class="label">Status</span>
                    <span class="value">
                        <span class="status-badge"
                              th:classappend="${payment.status} == 'SUCCESSFUL' ? ' status-successful' :
                                              (${payment.status} == 'PENDING' ? ' status-pending' : ' status-other')"
                              th:text="${payment.status}">
                            PENDING
                        </span>
                    </span>
                </p>
                <p>
                    <span class="label">Amount</span>
                    <span class="value"
                          th:text="${#numbers.formatDecimal(payment.amount, 1, 2)}">0.00</span>
                </p>
                <p>
                    <span class="label">Method</span>
                    <span class="value" th:text="${payment.method}">CARD</span>
                </p>
                <p>
                    <span class="label">Created</span>
                    <span class="value"
                          th:text="${#temporals.format(payment.createdOn, 'dd.MM.yyyy HH:mm')}">
                        01.01.2025 12:00
                    </span>
                </p>
                <p>
                    <span class="label">Order ID</span>
                    <span class="value small-mono" th:text="${payment.orderId}">order-id</span>
                </p>
                <p>
                    <span class="label">Payment ID</span>
                    <span class="value small-mono" th:text="${payment.id}">payment-id</span>
                </p>
            </div>

            <div class="payment-message" th:if="${payment.status == 'PENDING'}">
                <p>Please confirm your payment to complete the order.</p>
            </div>

            <div class="payment-message error" th:if="${payment.status == 'FAILED'}">
                <p>This payment has expired or failed. You can cancel the order and create a new one.</p>
            </div>

            <div class="payment-message success" th:if="${payment.status == 'SUCCESSFUL'}">
                <p>This payment has been completed. Thank you!</p>
            </div>

            <div class="payment-actions">
                <form th:if="${payment.status == 'PENDING'}"
                      th:action="@{|/orders/payment/${payment.id}/process|}"
                      method="post" class="inline-form">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                    <button type="submit" class="btn-primary">Pay now</button>
                </form>

                <form th:if="${payment != null and payment.status != 'PAID' and payment.status != 'SUCCESSFUL'}"
                      th:action="@{/orders/cancel}"
                      method="post" class="inline-form"
                      onsubmit="return confirm('Are you sure you want to cancel this order?');">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                    <input type="hidden" name="orderId" th:value="${payment.orderId}">
                    <button type="submit" class="btn-secondary">Cancel order</button>
                </form>

                <a th:if="${payment != null and (payment.status == 'PAID' or payment.status == 'SUCCESSFUL')}"
                   th:href="@{/orders}" href="/orders" class="btn-secondary">
                    Back to my orders
                </a>
            </div>
        </div>
    </section>
</div>
</body>
</html>
